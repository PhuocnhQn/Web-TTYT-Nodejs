<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User List</title>
    <link rel="stylesheet" href="/css/add-user.css">
    <link rel="stylesheet" href="/css/dashboard.css">
</head>

<body>
    <header>
        <h1>Welcome, <%= user ? user.name : 'Guest' %>
        </h1>
        <% if (user && user.role==='admin' ) { %>
            <p>Role: <%= user.role %>
            </p>
            <% } %>
    </header>

    <nav>
        <ul>
            <li><a href="/dashboard" class="nav-link">Trang ch·ªß</a></li>
            <% if (user && user.role==='admin' ) { %>
                <li class="reports-menu">
                    <a href="#" class="nav-link">Admin</a>
                    <ul class="sub-menu">
                        <li><a href="/users" class="nav-link">Qu·∫£ng tr·ªã ng∆∞·ªùi d√πng</a></li>
                        <li><a href="/qr" class="nav-link">T·∫°o QR</a></li>
                    </ul>
                </li>
                <% } %>
                    <li class="reports-menu">
                        <a href="#" class="nav-link">B√°o C√°o</a>
                        <ul class="sub-menu">
                            <li><a href="/reports/view" class="nav-link">B√°o C√°o Th√°ng</a></li>
                            <li><a href="/reports/aggregated" class="nav-link">B√°o C√°o T·ªïng H·ª£p</a></li>
                        </ul>
                    </li>
                    <li><a href="/user/change-password" class="nav-link">ƒê·ªïi m·∫≠t kh·∫©u</a></li>
                    <li><a href="/logout" class="logout-btn">ƒêƒÉng xu·∫•t</a></li>
        </ul>
    </nav>
    </dialog>
    <!-- H·ªôp tho·∫°i th√¥ng b√°o l·ªói -->
    <dialog id="errDialog">
        <div id="modificationDetails">
            <i class="fas fa-exclamation-triangle" style="color: red; font-size: 30px;"></i>
            <h2>üîî Th√¥ng B√°o L·ªói:</h2>
            <p id="error"></p>
            <button id="closeDialog">ƒê√≥ng</button>
        </div>
    </dialog>
    <dialog id="successfullyDialog">
        <div class="notification">
            <h2>üîî Th√¥ng B√°o:</h2>
            <p id="notificationSS">Kh√¥ng c√≥ l·ªói n√†o!</p>
            <button id="closeDialogSS">ƒê√≥ng</button>
        </div>
    </dialog>

    <dialog id="confirmDialog">
        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y kh√¥ng?</p>
        <button id="confirmYes">X√≥a</button>
        <button id="confirmNo">Kh√¥ng</button>
    </dialog>
    <h2>Th√™m ng∆∞·ªùi d√πng m·ªõi</h2>
    <div class="form-container">
        <form action="/add-user" method="POST">
            <div class="form-group">
                <label for="name">T√™n:</label>
                <input type="text" name="name" required>
            </div>
            <div class="form-group">
                <label for="username">T√†i Kho·∫£n:</label>
                <input type="text" name="username" required>
            </div>
            <div class="form-group">
                <label for="role">Vai Tr√≤:</label>
                <select name="role" required>
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <div class="form-group">
                <label for="password">M·∫≠t Kh·∫©u:</label>
                <input type="password" name="password" required>
            </div>
            <div class="form-actions">
                <button type="submit">Th√™m</button>
            </div>
        </form>
    </div>

    <h2>Danh s√°ch Ng∆∞·ªùi d√πng</h2>
    <table>
        <thead>
            <tr>
                <th>T√™n</th>
                <th>T√†i Kho·∫£n</th>
                <th>Vai Tr√≤</th>
                <th>Ch·ª©c nƒÉng</th>
            </tr>
        </thead>
        <tbody>
            <% if (Array.isArray(users) && users.length> 0) { %>
                <% users.forEach(usr=> { %>
                    <tr>
                        <td>
                            <%= usr.name %>
                        </td>
                        <td>
                            <%= usr.username %>
                        </td>
                        <td>
                            <%= usr.role %>
                        </td>
                        <td>
                            <button onclick="toggleEditForm('<%= usr._id %>')">S·ª≠a</button>
                            <!-- Thay ƒë·ªïi n√∫t x√≥a ƒë·ªÉ hi·ªÉn th·ªã h·ªôp tho·∫°i x√°c nh·∫≠n -->
                            <button type="button" onclick="showDeleteConfirmation('<%= usr._id %>')">X√≥a</button>

                            <!-- Form x√≥a ng∆∞·ªùi d√πng -->
                            <form action="/delete-user/<%= usr._id %>" method="POST" style="display:none;">
                                <button type="submit">X√≥a</button>
                            </form>

                            <form action="/edit-user/<%= usr._id %>" method="POST" id="edit-form-<%= usr._id %>"
                                class="edit-form">
                                <label for="name">T√™n:</label>
                                <input type="text" name="name" value="<%= usr.name %>" required><br>
                                <label for="username">T√†i Kho·∫£n:</label>
                                <input type="text" name="username" value="<%= usr.username %>" required><br>
                                <label for="role">Vai Tr√≤:</label>
                                <select name="role" required>
                                    <option value="admin" <%=usr.role==='admin' ? 'selected' : '' %>>Admin</option>
                                    <option value="user" <%=usr.role==='user' ? 'selected' : '' %>>User</option>
                                </select><br>
                                <label for="password">M·∫≠t kh·∫©u m·ªõi (ƒë·ªÉ tr·ªëng ƒë·ªÉ gi·ªØ nguy√™n):</label>
                                <input type="password" name="password"><br>
                                <button type="submit">L∆∞u</button>
                            </form>
                        </td>

                    </tr>
                    <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="4">Kh√¥ng c√≥ ng∆∞·ªùi d√πng n√†o</td>
                            </tr>
                            <% } %>
        </tbody>
    </table>

    <script src="../js/users.js"></script>
</body>

</html>