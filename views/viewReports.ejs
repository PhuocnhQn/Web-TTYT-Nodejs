<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem báo cáo</title>
    <link rel="stylesheet" href="/css/viewReports.css">

</head>

<body>
    <h1>Xem báo cáo</h1>
    <!-- Nút trở về trang chủ -->
    <button onclick="window.location.href='/dashboard';" class="btn-home">Trang Chủ</button>
    <!-- Form chọn tháng và năm -->
    <form action="/reports/view" method="GET">
        <label for="month">Tháng:</label>
        <select id="month" name="month" required>
            <% for (let i=1; i <=12; i++) { %>
                <option value="<%= i %>" <%=month==i ? 'selected' : '' %>><%= i %>
                </option>
                <% } %>
        </select>

        <label for="year">Năm:</label>
        <input type="number" id="year" name="year" value="<%= year || new Date().getFullYear() %>" required>

        <button type="submit">Xem báo cáo</button>
    </form>

    <% if (month && year) { %>
        <h2>Báo cáo cho <%= month %>/<%= year %>
        </h2>

        <h3>Báo cáo đã nộp</h3>
        <% if (reports.length> 0) { %>
            <table border="1">
                <thead>
                    <tr>
                        <th>Đơn vị</th>
                        <th>Tổng</th>
                        <th>Trẻ em</th>
                        <th>CCCD</th>
                        <th>Giấy Chứng Sinh</th>
                        <th>Giấy Chứng Tử</th>
                        <th>Phần Trăm</th>
                    </tr>
                </thead>
                <tbody>
                    <% reports.forEach(report=> { %>
                        <tr>
                            <td>
                                <%= report.reportingUnit %>
                            </td>
                            <td>
                                <%= report.totalVisits %>
                            </td>
                            <td>
                                <%= report.childrenUnder14 %>
                            </td>
                            <td>
                                <%= report.visitsWithIDExcludingChildren %>
                            </td>
                            <td>
                                <%= report.birthCertificate %>
                            </td>
                            <td>
                                <%= report.deathCertificate %>
                            </td>
                            <td>
                                <%= report.percentage %> %
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
            <% } else { %>
                <p>Không có báo cáo nào được gửi trong tháng này.</p>
                <% } %>

                    <h3>Người dùng không có báo cáo</h3>
                    <% if (usersWithoutReports.length> 0) { %>
                        <ul>
                            <% usersWithoutReports.forEach(user=> { %>
                                <li>
                                    <%= user.name %> (<%= user.username %>)
                                </li>
                                <% }) %>
                        </ul>
                        <% } else { %>
                            <p>Tất cả người dùng đã gửi báo cáo cho tháng này.</p>
                            <% } %>
                                <% } else { %>
                                    <p>Vui lòng chọn tháng và năm để xem báo cáo.</p>
                                    <% } %>
</body>

</html>